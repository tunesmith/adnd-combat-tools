(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[973],{1461:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/battle",function(){return r(1063)}])},1063:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return J}});var n=r(5893),o=r(7294),a=r(7715),l=r(134),u=r(5596),s=r.n(u),c=r(2757),i=function(e){var t=e.red,r=e.green,o=c.yr.filter((function(e){return e.key===r.armorType}))[0];o||console.error("Unable to find green armor type; using monster armor");var a=c.yr.filter((function(e){return e.key===t.armorType}))[0];a||console.error("Unable to find green armor type; using monster armor");var u=(0,l.Z)(t.class,t.level,(null===o||void 0===o?void 0:o.armorType)||null,r.armorClass,t.weapon),i=(0,l.Z)(r.class,r.level,(null===a||void 0===a?void 0:a.armorType)||null,t.armorClass,r.weapon);return(0,n.jsxs)("div",{className:s().outerCell,children:[(0,n.jsx)("div",{className:s().left,children:u}),(0,n.jsx)("div",{className:s().right,children:i})]})},f=r(9521),d=r(6387),p=r.n(d),m=r(6212),v=r(1051),b=r(650),y=r(2198),h=r.n(y),_=r(3935),w=r(6177),j=r.n(w),C=r(8885),g=r(5924),x=function(e){var t=e.setOpen,r=e.creatureName,o=e.handleCreatureName,a=e.creatureClass,l=e.handleCreatureClass,u=e.levelOptions,s=e.level,c=e.handleLevel,i=e.armorTypeOptions,f=e.armorType,d=e.handleArmorType,p=e.armorClassOptions,v=e.armorClass,b=e.handleArmorClass,y=e.weaponOptions,h=e.weapon,w=e.handleWeapon,x=e.row,O=document.getElementById("app-modal");return O?(0,_.createPortal)((0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:j().modalShadow,onClick:function(){t(!1)}}),(0,n.jsxs)("div",{className:j().modal,style:{backgroundColor:x?"var(--caput-martuum)":"var(--dark-olive-green)"},children:[(0,n.jsx)("input",{className:j().nameInput,type:"text",defaultValue:r,onBlur:o,placeholder:"(Name or label)"}),(0,n.jsx)("br",{}),(0,n.jsx)(C.ZP,{isSearchable:!1,instanceId:"creatureClass",styles:g.Z,value:m.A.filter((function(e){return e.value===a})),options:m.A,onChange:l}),(0,n.jsx)("br",{}),(0,n.jsx)(C.ZP,{isSearchable:!1,instanceId:"level",styles:g.Z,value:u.filter((function(e){return e.value===s})),options:u,onChange:c}),(0,n.jsx)("br",{}),(0,n.jsx)(C.ZP,{isSearchable:!1,instanceId:"armorType",styles:g.Z,value:i.filter((function(e){return e.value===f})),options:i,onChange:d}),(0,n.jsx)("br",{}),(0,n.jsx)(C.ZP,{isSearchable:!1,instanceId:"armorClass",styles:g.Z,value:p.current.filter((function(e){return e.value===v})),options:p.current,onChange:b}),(0,n.jsx)("br",{}),(0,n.jsx)(C.ZP,{isSearchable:!1,instanceId:"weapon",styles:g.Z,value:y.filter((function(e){return e.value===h})),options:y,onChange:w})]})]}),O):(0,n.jsx)(n.Fragment,{})};function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function I(e){return function(e){if(Array.isArray(e))return O(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return O(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return O(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var k=function(e){var t,r,a=e.row,l=e.col,u=e.creature,s=e.dispatch,i=(0,o.useState)(u.name),f=i[0],d=i[1],p=(0,o.useState)(u.class),y=p[0],_=p[1],w=(0,o.useRef)(u.class),j=(0,o.useState)(u.level),C=j[0],g=j[1],O=(0,o.useState)((0,v.zT)("monster"===u.class?"monster":(0,m.F)(u.class))),k=O[0],S=O[1],N=(0,o.useState)((0,b.CB)(u.class)),T=N[0],A=N[1],R=(0,o.useState)(u.weapon),P=R[0],B=R[1],E=(0,o.useState)((0,c.BO)(y)),F=E[0],Z=E[1],M=(0,o.useState)(u.armorType),D=M[0],U=M[1],G=(0,o.useRef)(I(Array(21)).map((function(e,t){return{value:10-t,label:"AC ".concat(10-t)}}))),H=(0,o.useState)(u.armorClass),L=H[0],Q=H[1],q=(0,o.useState)(!1),z=q[0],J=q[1],V=function(e){var t;return(null===(t=c.yr.filter((function(t){return t.key===e}))[0])||void 0===t?void 0:t.armorType)||10};return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:h().container,children:[(0,n.jsx)("div",{className:h().removeInput,children:(0,n.jsx)("button",{className:a<1?h().buttonRemoveColumn:h().buttonRemoveRow,onClick:function(){return s(a<1?{type:5,row:a,col:l}:{type:4,row:a,col:l})},children:"x"})}),(0,n.jsx)("div",{className:a<1?h().battleInputColumn:h().battleInputRow,onClick:function(){J(!0)},children:(0,n.jsxs)("div",{children:[f&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:h().creatureName,children:f}),(0,n.jsx)("br",{})]}),(null===(t=m.A.filter((function(e){return e.value===y}))[0])||void 0===t?void 0:t.label)||"(No class selected)",": ","monster"===y?(0,n.jsx)(n.Fragment,{children:"HD "}):(0,n.jsx)(n.Fragment,{children:"L"}),C,(0,n.jsx)("br",{}),D>1&&(0,n.jsxs)(n.Fragment,{children:[F.filter((function(e){return e.value===D}))[0].label,(0,n.jsx)("br",{})]}),"AC ",L,(0,n.jsx)("br",{}),(null===(r=T.filter((function(e){return e.value===P}))[0])||void 0===r?void 0:r.label)||"(No weapon selected"]})}),z&&(0,n.jsx)(x,{setOpen:J,creatureName:f,handleCreatureName:function(e){d(e.target.value),s({type:1,row:a,col:l,creature:{key:u.key,name:e.target.value,class:y,level:C,armorType:D,armorClass:L,weapon:P}})},creatureClass:y,handleCreatureClass:function(e){var t=null===e||void 0===e?void 0:e.value;if(t){if(t!==w.current){var r;_(t);var n=(0,v.zT)("monster"===t?"monster":(0,m.F)(t));S(n),g("1");var o=(0,c.BO)(t);Z(o);var i=o[0].value;U(i),Q(V(i));var d=(0,b.CB)(t);A(d);var p=null===(r=d[0])||void 0===r?void 0:r.value;p?B(p):console.error("Unable to load new weapon, using previous weapon: ".concat(P)),w.current=t,s({type:1,row:a,col:l,creature:{key:u.key,name:f,class:t,level:"1",armorType:o[0].value,armorClass:o[0].value?o[0].value:L,weapon:p||P}})}}else console.error("Could not switch creature class")},levelOptions:k,level:C,handleLevel:function(e){var t=null===e||void 0===e?void 0:e.value;t?(g(t),s({type:1,row:a,col:l,creature:{key:u.key,name:f,class:y,level:t,armorType:D,armorClass:L,weapon:P}})):console.error("could not switch to new level")},armorTypeOptions:F,armorType:D,handleArmorType:function(e){var t=null===e||void 0===e?void 0:e.value;if(t){U(t);var r=V(t);Q(r),s({type:1,row:a,col:l,creature:{key:u.key,name:f,class:y,level:C,armorType:t,armorClass:r,weapon:P}})}else console.error("Could not switch to new armor type")},armorClassOptions:G,armorClass:L,handleArmorClass:function(e){var t=null===e||void 0===e?void 0:e.value;t?(Q(t),s({type:1,row:a,col:l,creature:{key:u.key,name:f,class:y,level:C,armorType:D,armorClass:t,weapon:P}})):console.error("Could not switch to new armor class")},weaponOptions:T,weapon:P,handleWeapon:function(e){var t=null===e||void 0===e?void 0:e.value;t?(B(t),s({type:1,row:a,col:l,creature:{key:u.key,name:f,class:y,level:C,armorType:D,armorClass:L,weapon:t}})):console.error("Could not select new weapon")},row:a})]})})},S=r(1752),N=r(3454);function T(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function A(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){T(e,t,r[t])}))}return e}function R(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var P=function(e){var t=e.rememberedState,r=(0,S.default)().publicRuntimeConfig.NODE_ENV,l=(0,o.useState)(void 0),u=l[0],s=l[1],c=(0,o.useRef)(0),d=(0,o.useMemo)((function(){return{class:"monster",level:"1",armorType:1,armorClass:5,weapon:1}}),[]),m=function(){return c.current++,c.current},v=(0,o.useMemo)((function(){return[[{},A({key:m()},d),A({key:m()},d)],[A({key:m()},d),{},{}],[A({key:m()},d),{},{}],[A({key:m()},d),{},{}]]}),[d]),b=(0,o.useMemo)((function(){return t||v}),[v,t]),y=(0,o.useReducer)((function(e,t){switch(t.type){case 5:return e.map((function(e){return e.filter((function(e,r){return r!==t.col}))}));case 4:return e.filter((function(e,r){return r!==t.row}));case 3:return e.map((function(e,t){return e.concat(0===t?A({key:m()},d):{})}));case 2:var r=e[0].length,n=[A({key:m()},d)].concat(r>1?Array(r-1).fill({}):[]);return e.concat([n]);default:return e.map((function(e,r){return r===t.row?e.map((function(e,r){return r===t.col?t.creature:e})):e.slice()}))}}),b),h=y[0],_=y[1];(0,o.useEffect)((function(){(0,a.deflate)(JSON.stringify({version:3,state:h}),(function(e,t){e&&(console.error("An error occurred:",e),N.exitCode=1),s(encodeURIComponent(t.toString("base64")))}))}),[h]),(0,o.useEffect)((function(){return function(){console.log("unmounting Battle")}}),[]),(0,o.useEffect)((function(){u&&window.history.replaceState({},"","production"!==r?"/battle?s=".concat(u):"/adnd-combat-tools/battle?s=".concat(u))}),[r,u]);var w=(0,o.useCallback)((function(e,t){return(0,n.jsx)(i,{red:h[e.row.index+1][0],green:h[0][t]})}),[h]),j=(0,o.useMemo)((function(){return[{Header:(0,n.jsxs)("div",{className:p().tableTitle,children:["AD&D",(0,n.jsx)("br",{}),"Battle Grid"]}),accessor:"col0"}].concat(h[0].slice(1).map((function(e,t){return{Header:(0,n.jsx)(k,{row:0,col:t+1,creature:e,dispatch:_},e.key),accessor:"col".concat(t+1),Cell:function(e){return w(e,t+1)}}})))}),[w,h]),C=(0,o.useMemo)((function(){return h.slice(1).map((function(e,t){return{col0:(0,n.jsx)(k,{row:t+1,col:0,creature:e[0],dispatch:_},e[0].key)}}))}),[h]),g=(0,f.useTable)({columns:j,data:C}),x=g.getTableProps,O=g.getTableBodyProps,I=g.headerGroups,T=g.rows,P=g.prepareRow;return(0,n.jsx)("div",{id:"app-modal",children:(0,n.jsxs)("div",{className:p().container,children:[(0,n.jsx)("div",{className:p().addColumn,children:(0,n.jsx)("button",{className:p().buttonAddColumn,onClick:function(){return _({type:3})},children:"+"})}),(0,n.jsxs)("table",A({className:p().myBorder},x(),{children:[(0,n.jsx)("thead",{children:I.map((function(e){var t=e.getHeaderGroupProps(),r=t.key,o=R(t,["key"]);return(0,n.jsx)("tr",A({},o,{children:e.headers.map((function(e){var t=e.getHeaderProps(),r=t.key,o=R(t,["key"]);return(0,n.jsx)("th",A({},o,{children:e.render("Header")}),r)}))}),r)}))}),(0,n.jsx)("tbody",A({},O(),{children:T.map((function(e){return P(e),(0,n.jsx)("tr",A({},e.getRowProps(),{children:e.cells.map((function(e){return(0,n.jsx)("td",A({},e.getCellProps(),{children:e.render("Cell")}))}))}))}))}))]})),(0,n.jsx)("div",{className:p().addRow,children:(0,n.jsx)("button",{className:p().buttonAddRow,onClick:function(){return _({type:2})},children:"+"})})]})})},B=r(1163),E=r(4051),F=r.n(E),Z=r(1876).Buffer,M=r(3454);function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function U(e,t,r,n,o,a,l){try{var u=e[a](l),s=u.value}catch(c){return void r(c)}u.done?t(s):Promise.resolve(s).then(n,o)}function G(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function l(e){U(a,n,o,l,u,"next",e)}function u(e){U(a,n,o,l,u,"throw",e)}l(void 0)}))}}function H(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function L(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){H(e,t,r[t])}))}return e}function Q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a=[],l=!0,u=!1;try{for(r=r.call(e);!(l=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);l=!0);}catch(s){u=!0,o=s}finally{try{l||null==r.return||r.return()}finally{if(u)throw o}}return a}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return D(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return D(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var q=function(e){switch(e.version){case 1:return e.state.map((function(e){return e.map((function(e){if(Object.keys(e).length){var t=e,r=c.yr.filter((function(e){return e.armorType===((r=t.armorType).trim()?parseInt(r,10):null);var r}))[0],n=Array.from(b.Ar).filter((function(e){var r=Q(e,2);r[0];return r[1].name===t.weapon}))[0];return L({},t,{armorType:r?r.key:0,weapon:n?n[0]:0})}return e}))}));case 2:return e.state.map((function(e){return e.map((function(e){if(Object.keys(e).length){var t=e,r=Array.from(b.Ar).filter((function(e){var r=Q(e,2);r[0];return r[1].name===t.weapon}))[0];return L({},t,{weapon:r?r[0]:0})}return e}))}));default:return e.state}},z=function(e){var t=e.encodedState,r=(0,o.useState)(void 0),l=r[0],u=r[1];return(0,o.useEffect)((function(){var e=!0;return function(){r.apply(this,arguments)}(),function(){e=!1};function r(){return(r=G(F().mark((function r(){var n;return F().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:u(void 0),n=Z.from(decodeURI(t),"base64"),(0,a.unzip)(n,(function(t,r){t&&(console.error("An error occurred:",t),M.exitCode=1);var n=JSON.parse(r.toString());e&&u(q(n))}));case 3:case"end":return r.stop()}}),r)})))).apply(this,arguments)}}),[t]),(0,n.jsx)(n.Fragment,{children:l&&(0,n.jsx)(P,{rememberedState:l})})},J=function(){var e=(0,B.useRouter)(),t=(0,o.useState)(!1),r=t[0],a=t[1],l=e.query.s;return(0,o.useEffect)((function(){e.isReady&&a(!0)}),[e.isReady]),r?l?(0,n.jsx)(z,{encodedState:l}):(0,n.jsx)(P,{}):(0,n.jsx)(n.Fragment,{})}},6387:function(e){e.exports={eggshell:"#F0EFDD",container:"battle_container__jOK3k",addColumn:"battle_addColumn__Glgxv",addRow:"battle_addRow__vsUfL",buttonBase:"battle_buttonBase__T7y3f",buttonAddRow:"battle_buttonAddRow__XvZNM battle_buttonBase__T7y3f",buttonAddColumn:"battle_buttonAddColumn__MttIL battle_buttonBase__T7y3f",myBorder:"battle_myBorder__DZpxH",tableTitle:"battle_tableTitle___IoaN"}},2198:function(e){e.exports={container:"battleInput_container__snaa3",buttonRemoveColumn:"battleInput_buttonRemoveColumn__oZQhs battleInput_buttonBase__bRQPF",buttonRemoveRow:"battleInput_buttonRemoveRow__7VYOu battleInput_buttonBase__bRQPF",removeInput:"battleInput_removeInput__ZCgfN",buttonBase:"battleInput_buttonBase__bRQPF",battleInput:"battleInput_battleInput__p1o3G",battleInputColumn:"battleInput_battleInputColumn__4jFpI battleInput_battleInput__p1o3G",battleInputRow:"battleInput_battleInputRow__04l_x battleInput_battleInput__p1o3G",creatureName:"battleInput_creatureName__JqfyT"}},6177:function(e){e.exports={modalShadow:"battleModal_modalShadow__vrTuw",modal:"battleModal_modal__C7q8v",nameInput:"battleModal_nameInput__TbCNp"}},5596:function(e){e.exports={outerCell:"cellOutput_outerCell__IKmle",left:"cellOutput_left__E98RM",right:"cellOutput_right__gNDDm"}}},function(e){e.O(0,[885,582,342,774,888,179],(function(){return t=1461,e(e.s=t);var t}));var t=e.O();_N_E=t}]);