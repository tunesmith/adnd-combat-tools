(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[973],{1461:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/battle",function(){return r(1063)}])},1063:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return L}});var n=r(5893),a=r(7294),o=r(7715),l=r(134),u=r(5596),s=r.n(u),c=function(e){var t=e.red,r=e.green,a=(0,l.Z)(t.class,t.level,r.armorType,r.armorClass,t.weapon),o=(0,l.Z)(r.class,r.level,t.armorType,t.armorClass,r.weapon);return(0,n.jsxs)("div",{className:s().outerCell,children:[(0,n.jsx)("div",{className:s().left,children:a}),(0,n.jsx)("div",{className:s().right,children:o})]})},i=r(9521),p=r(6387),d=r.n(p),m=r(6212),f=r(1051),b=r(650),v=r(2757),y=r(2198),_=r.n(y),h=r(3935),w=r(6177),x=r.n(w),j=r(8885),C=r(5924),g=function(e){var t=e.setOpen,r=e.creatureName,a=e.handleCreatureName,o=e.creatureClass,l=e.handleCreatureClass,u=e.levelOptions,s=e.level,c=e.handleLevel,i=e.armorTypeOptions,p=e.armorType,d=e.handleArmorType,f=e.armorClassOptions,b=e.armorClass,v=e.handleArmorClass,y=e.weaponOptions,_=e.weapon,w=e.handleWeapon,g=e.row;return(0,h.createPortal)((0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:x().modalShadow,onClick:function(){t(!1)}}),(0,n.jsxs)("div",{className:x().modal,style:{backgroundColor:g?"var(--caput-martuum)":"var(--dark-olive-green)"},children:[(0,n.jsx)("input",{className:x().nameInput,type:"text",defaultValue:r,onBlur:a,placeholder:"(Name or label)"}),(0,n.jsx)("br",{}),(0,n.jsx)(j.ZP,{isSearchable:!1,instanceId:"creatureClass",styles:C.Z,value:m.A.filter((function(e){return e.value===o})),options:m.A,onChange:l}),(0,n.jsx)("br",{}),(0,n.jsx)(j.ZP,{isSearchable:!1,instanceId:"level",styles:C.Z,value:u.filter((function(e){return e.value===s})),options:u,onChange:c}),(0,n.jsx)("br",{}),(0,n.jsx)(j.ZP,{isSearchable:!1,instanceId:"armorType",styles:C.Z,value:i.filter((function(e){return e.value===p})),options:i,onChange:d}),(0,n.jsx)("br",{}),(0,n.jsx)(j.ZP,{isSearchable:!1,instanceId:"armorClass",styles:C.Z,value:f.current.filter((function(e){return e.value===b})),options:f.current,onChange:v}),(0,n.jsx)("br",{}),(0,n.jsx)(j.ZP,{isSearchable:!1,instanceId:"weapon",styles:C.Z,value:y.filter((function(e){return e.value===_})),options:y,onChange:w})]})]}),document.getElementById("app-modal"))};function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function k(e){return function(e){if(Array.isArray(e))return I(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return I(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return I(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var N=function(e){var t=e.row,r=e.col,o=e.creature,l=e.dispatch,u=(0,a.useState)(o.name),s=u[0],c=u[1],i=(0,a.useState)(o.class),p=i[0],d=i[1],y=(0,a.useRef)(o.class),h=(0,a.useState)(o.level),w=h[0],x=h[1],j=(0,a.useState)((0,f.zT)("monster"===o.class?"monster":m.$[o.class])),C=j[0],I=j[1],N=(0,a.useState)((0,b.C)(o.class)),S=N[0],O=N[1],R=(0,a.useState)(o.weapon),T=R[0],A=R[1],P=(0,a.useState)((0,v.n)(p)),E=P[0],B=P[1],Z=(0,a.useState)(o.armorType),F=Z[0],M=Z[1],D=(0,a.useRef)(k(Array(21)).map((function(e,t){return{value:10-t,label:"AC ".concat(10-t)}}))),G=(0,a.useState)(o.armorClass),H=G[0],L=G[1],Q=(0,a.useState)(!1),U=Q[0],q=Q[1];return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:_().container,children:[(0,n.jsx)("div",{className:_().removeInput,children:(0,n.jsx)("button",{className:t<1?_().buttonRemoveColumn:_().buttonRemoveRow,onClick:function(){return l(t<1?{type:5,row:t,col:r}:{type:4,row:t,col:r})},children:"x"})}),(0,n.jsx)("div",{className:t<1?_().battleInputColumn:_().battleInputRow,onClick:function(){q(!0)},children:(0,n.jsxs)("div",{children:[s&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:_().creatureName,children:s}),(0,n.jsx)("br",{})]}),m.A.filter((function(e){return e.value===p}))[0].label,": ","monster"===p?(0,n.jsx)(n.Fragment,{children:"HD "}):(0,n.jsx)(n.Fragment,{children:"L"}),w,(0,n.jsx)("br",{}),F.trim()&&(0,n.jsxs)(n.Fragment,{children:[E.filter((function(e){return e.value===F}))[0].label,(0,n.jsx)("br",{})]}),"AC ",H,(0,n.jsx)("br",{}),S.filter((function(e){return e.value===T}))[0].label]})}),U&&(0,n.jsx)(g,{setOpen:q,creatureName:s,handleCreatureName:function(e){c(e.target.value),l({type:1,row:t,col:r,creature:{key:o.key,name:e.target.value,class:p,level:w,armorType:F,armorClass:H,weapon:T}})},creatureClass:p,handleCreatureClass:function(e){var n=e.value;if(n!==y.current){d(n);var a=(0,f.zT)("monster"===n?"monster":m.$[n]);I(a),x("1");var u=(0,v.n)(n);B(u);var c=u[0].value;M(c);var i=c.trim()?parseInt(c,10):H;L(i);var p=(0,b.C)(n);O(p);var _=p[0].value;A(_),y.current=n,l({type:1,row:t,col:r,creature:{key:o.key,name:s,class:n,level:"1",armorType:u[0].value,armorClass:u[0].value.trim()?parseInt(u[0].value,10):H,weapon:_}})}},levelOptions:C,level:w,handleLevel:function(e){x(e.value),l({type:1,row:t,col:r,creature:{key:o.key,name:s,class:p,level:e.value,armorType:F,armorClass:H,weapon:T}})},armorTypeOptions:E,armorType:F,handleArmorType:function(e){M(e.value),e.value.trim()&&L(parseInt(e.value,10)),l({type:1,row:t,col:r,creature:{key:o.key,name:s,class:p,level:w,armorType:e.value,armorClass:e.value.trim()?parseInt(e.value,10):H,weapon:T}})},armorClassOptions:D,armorClass:H,handleArmorClass:function(e){L(e.value),l({type:1,row:t,col:r,creature:{key:o.key,name:s,class:p,level:w,armorType:F,armorClass:e.value,weapon:T}})},weaponOptions:S,weapon:T,handleWeapon:function(e){A(e.value),l({type:1,row:t,col:r,creature:{key:o.key,name:s,class:p,level:w,armorType:F,armorClass:H,weapon:e.value}})},row:t})]})})},S=r(1752),O=r(3454);function R(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){R(e,t,r[t])}))}return e}function A(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var P=function(e){var t=e.rememberedState,r=(0,S.default)().publicRuntimeConfig.NODE_ENV,l=(0,a.useState)(void 0),u=l[0],s=l[1],p=(0,a.useRef)(0),m=(0,a.useMemo)((function(){return{class:"monster",level:"1",armorType:" ",armorClass:5,weapon:"Natural Weapon (Monster)"}}),[]),f=function(){return p.current++,p.current},b=(0,a.useMemo)((function(){return[[{},T({key:f()},m),T({key:f()},m)],[T({key:f()},m),{},{}],[T({key:f()},m),{},{}],[T({key:f()},m),{},{}]]}),[m]),v=(0,a.useMemo)((function(){return t||b}),[b,t]),y=(0,a.useReducer)((function(e,t){switch(t.type){case 5:return e.map((function(e){return e.filter((function(e,r){return r!==t.col}))}));case 4:return e.filter((function(e,r){return r!==t.row}));case 3:return e.map((function(e,t){return e.concat(0===t?T({key:f()},m):{})}));case 2:var r=e[0].length,n=[T({key:f()},m)].concat(r>1?Array(r-1).fill({}):[]);return e.concat([n]);default:return e.map((function(e,r){return r===t.row?e.map((function(e,r){return r===t.col?t.creature:e})):e.slice()}))}}),v),_=y[0],h=y[1];(0,a.useEffect)((function(){(0,o.deflate)(JSON.stringify({version:1,state:_}),(function(e,t){e&&(console.error("An error occurred:",e),O.exitCode=1),s(encodeURIComponent(t.toString("base64")))}))}),[_]),(0,a.useEffect)((function(){return function(){console.log("unmounting Battle")}}),[]),(0,a.useEffect)((function(){u&&window.history.replaceState({},"","production"!==r?"/battle?s=".concat(u):"/adnd-combat-tools/battle?s=".concat(u))}),[r,u]);var w=(0,a.useCallback)((function(e,t){return(0,n.jsx)(c,{red:_[e.row.index+1][0],green:_[0][t]})}),[_]),x=(0,a.useMemo)((function(){return[{Header:(0,n.jsxs)("div",{className:d().tableTitle,children:["AD&D",(0,n.jsx)("br",{}),"Battle Grid"]}),accessor:"col0"}].concat(_[0].slice(1).map((function(e,t){return{Header:(0,n.jsx)(N,{row:0,col:t+1,creature:e,dispatch:h},e.key),accessor:"col".concat(t+1),Cell:function(e){return w(e,t+1)}}})))}),[w,_]),j=(0,a.useMemo)((function(){return _.slice(1).map((function(e,t){return{col0:(0,n.jsx)(N,{row:t+1,col:0,creature:e[0],dispatch:h},e[0].key)}}))}),[_]),C=(0,i.useTable)({columns:x,data:j}),g=C.getTableProps,I=C.getTableBodyProps,k=C.headerGroups,R=C.rows,P=C.prepareRow;return(0,n.jsx)("div",{id:"app-modal",children:(0,n.jsxs)("div",{className:d().container,children:[(0,n.jsx)("div",{className:d().addColumn,children:(0,n.jsx)("button",{className:d().buttonAddColumn,onClick:function(){return h({type:3})},children:"+"})}),(0,n.jsxs)("table",T({className:d().myBorder},g(),{children:[(0,n.jsx)("thead",{children:k.map((function(e){var t=e.getHeaderGroupProps(),r=t.key,a=A(t,["key"]);return(0,n.jsx)("tr",T({},a,{children:e.headers.map((function(e){var t=e.getHeaderProps(),r=t.key,a=A(t,["key"]);return(0,n.jsx)("th",T({},a,{children:e.render("Header")}),r)}))}),r)}))}),(0,n.jsx)("tbody",T({},I(),{children:R.map((function(e){return P(e),(0,n.jsx)("tr",T({},e.getRowProps(),{children:e.cells.map((function(e){return(0,n.jsx)("td",T({},e.getCellProps(),{children:e.render("Cell")}))}))}))}))}))]})),(0,n.jsx)("div",{className:d().addRow,children:(0,n.jsx)("button",{className:d().buttonAddRow,onClick:function(){return h({type:2})},children:"+"})})]})})},E=r(1163),B=r(4051),Z=r.n(B),F=r(1876).Buffer,M=r(3454);function D(e,t,r,n,a,o,l){try{var u=e[o](l),s=u.value}catch(c){return void r(c)}u.done?t(s):Promise.resolve(s).then(n,a)}function G(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function l(e){D(o,n,a,l,u,"next",e)}function u(e){D(o,n,a,l,u,"throw",e)}l(void 0)}))}}var H=function(e){var t=e.encodedState,r=(0,a.useState)(void 0),l=r[0],u=r[1];return(0,a.useEffect)((function(){var e=!0;return function(){r.apply(this,arguments)}(),function(){e=!1};function r(){return(r=G(Z().mark((function r(){var n;return Z().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:u(void 0),n=F.from(decodeURI(t),"base64"),(0,o.unzip)(n,(function(t,r){t&&(console.error("An error occurred:",t),M.exitCode=1);var n=JSON.parse(r.toString());e&&u(n.state)}));case 3:case"end":return r.stop()}}),r)})))).apply(this,arguments)}}),[t]),(0,n.jsx)(n.Fragment,{children:l&&(0,n.jsx)(P,{rememberedState:l})})},L=function(){var e=(0,E.useRouter)(),t=(0,a.useState)(!1),r=t[0],o=t[1],l=e.query.s;return(0,a.useEffect)((function(){e.isReady&&o(!0)}),[e.isReady]),r?l?(0,n.jsx)(H,{encodedState:l}):(0,n.jsx)(P,{}):(0,n.jsx)(n.Fragment,{})}},6387:function(e){e.exports={eggshell:"#F0EFDD",container:"battle_container__jOK3k",addColumn:"battle_addColumn__Glgxv",addRow:"battle_addRow__vsUfL",buttonBase:"battle_buttonBase__T7y3f",buttonAddRow:"battle_buttonAddRow__XvZNM battle_buttonBase__T7y3f",buttonAddColumn:"battle_buttonAddColumn__MttIL battle_buttonBase__T7y3f",myBorder:"battle_myBorder__DZpxH",tableTitle:"battle_tableTitle___IoaN"}},2198:function(e){e.exports={container:"battleInput_container__snaa3",buttonRemoveColumn:"battleInput_buttonRemoveColumn__oZQhs battleInput_buttonBase__bRQPF",buttonRemoveRow:"battleInput_buttonRemoveRow__7VYOu battleInput_buttonBase__bRQPF",removeInput:"battleInput_removeInput__ZCgfN",buttonBase:"battleInput_buttonBase__bRQPF",battleInput:"battleInput_battleInput__p1o3G",battleInputColumn:"battleInput_battleInputColumn__4jFpI battleInput_battleInput__p1o3G",battleInputRow:"battleInput_battleInputRow__04l_x battleInput_battleInput__p1o3G",creatureName:"battleInput_creatureName__JqfyT"}},6177:function(e){e.exports={modalShadow:"battleModal_modalShadow__vrTuw",modal:"battleModal_modal__C7q8v",nameInput:"battleModal_nameInput__TbCNp"}},5596:function(e){e.exports={outerCell:"cellOutput_outerCell__IKmle",left:"cellOutput_left__E98RM",right:"cellOutput_right__gNDDm"}}},function(e){e.O(0,[885,582,342,774,888,179],(function(){return t=1461,e(e.s=t);var t}));var t=e.O();_N_E=t}]);